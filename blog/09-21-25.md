This is a weblog and it is mine so I get to do whatever I want with it.
Today I had a struggle with a server I set up in haste that I then went back to and wanted to add to, so this time I will document what I went through a bit so I can reference it, although I don't think I will have the same struggles as I've decided to take an easier route to what I did last time (that I can recall).
Essentially, I have a raspberry pi 4 that I used as a motion host (not motioneye, which was overkill at the time and if only for this probably still would be). It was running dietpi and used to have a ribbon cable serial connection type camera attached to it, which was very goofy looking and not good but did what I needed it to do. It was also an absolute pain to setup and configure, and I could not get motioneye to recognize it, not that I needed to use motioneye, I instead just had motion set to stream the output to a port and it was perfectly acceptable as I could just access it through tailscale. However, today I decided to add another service that I had been eyeing and wanted to experiment with a bit, which was copyparty, which I highly recommend for any filehosting you might want to self-host. However, I decided to haphazardly blind update my diet pi, and while it worked for a bit, I decided to unplug it and access it directly, at which point it seemed to have an issue with the sd card (a micro center sd card that basically ran uninterrupted in the summer heat for many months on end, no real surprise it ended up somewhat unsalvageable). This was a good opportunity to redo the server however, which involved some unnecessary hoop jumping trying to get the original camera working again, encountering the same issues but not remembering what obscure forums and configs I went through, until settling to just using the same dietpi setup but this time with motioneye and a usb camera instead, a hundreds of times easier setup.
Regardless, I also wanted to configure it to be a tiny bit more secure; before you could just ssh in locally, but I decided to point everything to tailscale only this time. The following are the steps I take as I write this out:

Normally you edit /etc/ssh/sshd_config and add ListenAddress ~inserttailscaleip~ when using openssh-server. However, dietpi uses dropbear by default which is lighter weight. I use a simple systemd override:
```[Service]
Environment="DROPBEAR_PORT=~inserttailscaleip~:22"```
to replace the environment variable that dropbear uses to configure itself.

For motioneye, /etc/motioneye/motioneye.conf has:
```
listen ~inserttailscaleip~
```
which is self explanatory (no port after)
```(sudo) systemctl status motioneye```
should resolve to relatively clean output.
What I had had some issues with was trying to do the same as the above, executing the start command with a binded ip, but this was the wrong way to go.

For copyparty, following the instructions in the service file covers everything you need to know. Only thing of note was adding rich rules for every port used with addresses in the range of tailscale:
```firewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="100.64.0.0/10" port protocol="tcp" port="~insert port here~" accept'```
/10 covers every ip range for tailscale
tailscale does not create permanent entries so you have to add these rich rules when using firewall-cmd.
For copy party specifically also should make sure to setup a proper config file; I kept mine barebones as I only want to use it currently as a way to easily transfer files between my phone and a computer (stopped using dropbox a few years ago for this role).
